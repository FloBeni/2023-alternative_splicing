# Generate Data 1
options(stringsAsFactors = F, scipen = 999)
library(readxl)
library(stringr)
library(dplyr)
library(tidyr)
get_rsquared_slope = function(prop.quantile = 0.1,Xaxis,Yaxis){
quantile = unique(quantile(Xaxis, probs = seq(0, 1,prop.quantile),na.rm=T))
intervalle = cut(Xaxis, quantile,include.lowest = T,include.higher=T)
X = tapply(Xaxis, intervalle, median)
if ( !any(is.na(X)) ){
Y = tapply(Yaxis, intervalle, mean)
X = log10(X)
pearson_method = cor.test(X, Y,method="pearson")
cor = pearson_method$estimate
pval_cor = pearson_method$p.value
return( c(cor,pval_cor) )
} else {
return(
c(NA,NA)
)
}
}
read_excel_allsheets <- function(filename, tibble = FALSE) {
sheets <- readxl::excel_sheets(filename)
x <-
lapply(sheets, function(X)
readxl::read_excel(filename, sheet = X))
if (!tibble)
x <- lapply(x, as.data.frame)
names(x) <- sheets
x
}
pathData="/home/fbenitiere/data//Projet-SplicedVariants/"
pathData="/beegfs/data/fbenitiere/Projet-SplicedVariants/"
mysheets <- read_excel_allsheets(paste(pathData,"Fichiers-data/metazoa_species.xls",sep=""))
# Generate Data 1
options(stringsAsFactors = F, scipen = 999)
library(readxl)
library(stringr)
library(dplyr)
library(tidyr)
get_rsquared_slope = function(prop.quantile = 0.1,Xaxis,Yaxis){
quantile = unique(quantile(Xaxis, probs = seq(0, 1,prop.quantile),na.rm=T))
intervalle = cut(Xaxis, quantile,include.lowest = T,include.higher=T)
X = tapply(Xaxis, intervalle, median)
if ( !any(is.na(X)) ){
Y = tapply(Yaxis, intervalle, mean)
X = log10(X)
pearson_method = cor.test(X, Y,method="pearson")
cor = pearson_method$estimate
pval_cor = pearson_method$p.value
return( c(cor,pval_cor) )
} else {
return(
c(NA,NA)
)
}
}
read_excel_allsheets <- function(filename, tibble = FALSE) {
sheets <- readxl::excel_sheets(filename)
x <-
lapply(sheets, function(X)
readxl::read_excel(filename, sheet = X))
if (!tibble)
x <- lapply(x, as.data.frame)
names(x) <- sheets
x
}
pathData="/home/fbenitiere/data//Projet-SplicedVariants/"
# pathData="/beegfs/data/fbenitiere/Projet-SplicedVariants/"
mysheets <- read_excel_allsheets(paste(pathData,"Fichiers-data/metazoa_species.xls",sep=""))
sp_studied = c()
for (species in names(mysheets)){
if (!is.na(mysheets[[species]]$Group_study[1]) & (mysheets[[species]]$Group_study[1] == "53_sp" | mysheets[[species]]$Group_study[1] == "69_sp")){
sp_studied = append(sp_studied,species)
}
}
data_dNdS_subset_200k_v2 = read.delim(paste(pathData , "DnDs/Metazoa_species_filtered_v53.2/subset_200_ksites_GC3_v2/data_calculation.tab",sep=""))
get_CM_dNdS<-function(D) {
# Compute the cumulated number of substitutions over all genes
cum_KS=sum(D$num_dS)
cum_KN=sum(D$num_dN)
cum_OS=sum(D$den_dS/D$branch_length)
cum_ON=sum(D$den_dS/D$branch_length)
# Compute cumulated DN, DS
cum_dS = cum_KS/cum_OS
cum_dN = cum_KN/cum_ON
# Compute cumulated dN/dS
cum_dNdS=cum_dN/cum_dS
return(cum_dNdS)
}
data_1 = data.frame()
