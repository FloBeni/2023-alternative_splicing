############## Pannel 2 C
point_color = c("Brain"="#5c89b2","Cerebellum"="#7bc7eb","Heart"="#8c1b1f","Liver"="#54833b","Kidney"="#c19e40",
"Testis"="#e16527","Ovary"="#ac3495","Head"="#A6CEE3")
# "#1F78B4" "#B2DF8A" "#33A02C" "#FB9A99" "#E31A1C" "#FDBF6F" "#FF7F00" "#fdfd99" "#e2cc1a"
point_shape=c("Gallus gallus"=5,
"Homo sapiens"=0,
"Macaca mulatta"=8,
"Monodelphis domestica"=2,
"Mus musculus"=1,
"Oryctolagus cuniculus"=4,
"Rattus norvegicus"=6,
"Dendroctonus ponderosae"=10
)
data_4 = read.delim("data/Data4_supp.tab",comment.char = "#")
data_4$species_name = str_replace_all(data_4$species,"_"," ")
data_4$longevity = data_1[data_4$species,]$longevity
data_4 = data_4[data_4$organs %in% names(point_color),]
life_span_order = tapply(data_4$longevity,data_4$species_name,mean)
life_span_order = life_span_order[order(life_span_order,decreasing = T)]
data_4$species_name = factor( data_4$species_name, levels = names(life_span_order))
p2 = ggplot(font.label = c(50, "plain"),font.legend= c(20, "plain"),font.x= c(20, "plain"),font.y= c(20, "plain"),
data_4, aes(x=longevity, y=SVR,group=species_name,shape=species_name)) +   ggtitle("Major introns (BUSCO genes)")+
geom_point(size=5,alpha=1,aes(color=organs),stroke=1.5)+ scale_color_manual("Organs",values=point_color) +
scale_y_continuous(breaks=seq(0.5,4.5,0.5),labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(0.5,4)) +
scale_shape_manual("Species",values=point_shape) + labs(fill="Species") +
xlab("Longevity (days, log scale)") + theme_bw() + theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26, family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif"),
plot.caption = element_text(hjust = 0.365, face= "italic", size=23),
plot.caption.position =  "plot"
) + labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,5000,10000,50000)
# , limits=c(1000,50000)
) +
guides(shape = guide_legend(override.aes = list(stroke=1.1),
label.theme = element_text(color="black", size=26,face="italic", family="serif",vjust = 1.5,margin = margin(t = 5)))
,color = guide_legend(override.aes = list(shape = 16, size = 6),
label.theme = element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 5))))+
labs(
caption = substitute(paste("LM model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(lm((data_4$SVR)~log10(data_4$longevity)))))
)
p2
############## Pannel 2 C
point_color = c("Brain"="#5c89b2","Cerebellum"="#7bc7eb","Heart"="#8c1b1f","Liver"="#54833b","Kidney"="#c19e40",
"Testis"="#e16527","Ovary"="#ac3495","Head"="#A6CEE3")
# "#1F78B4" "#B2DF8A" "#33A02C" "#FB9A99" "#E31A1C" "#FDBF6F" "#FF7F00" "#fdfd99" "#e2cc1a"
point_shape=c("Gallus gallus"=5,
"Homo sapiens"=0,
"Macaca mulatta"=8,
"Monodelphis domestica"=2,
"Mus musculus"=1,
"Oryctolagus cuniculus"=4,
"Rattus norvegicus"=6,
"Dendroctonus ponderosae"=9
)
data_4 = read.delim("data/Data4_supp.tab",comment.char = "#")
data_4$species_name = str_replace_all(data_4$species,"_"," ")
data_4$longevity = data_1[data_4$species,]$longevity
data_4 = data_4[data_4$organs %in% names(point_color),]
life_span_order = tapply(data_4$longevity,data_4$species_name,mean)
life_span_order = life_span_order[order(life_span_order,decreasing = T)]
data_4$species_name = factor( data_4$species_name, levels = names(life_span_order))
p2 = ggplot(font.label = c(50, "plain"),font.legend= c(20, "plain"),font.x= c(20, "plain"),font.y= c(20, "plain"),
data_4, aes(x=longevity, y=SVR,group=species_name,shape=species_name)) +   ggtitle("Major introns (BUSCO genes)")+
geom_point(size=5,alpha=1,aes(color=organs),stroke=1.5)+ scale_color_manual("Organs",values=point_color) +
scale_y_continuous(breaks=seq(0.5,4.5,0.5),labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(0.5,4)) +
scale_shape_manual("Species",values=point_shape) + labs(fill="Species") +
xlab("Longevity (days, log scale)") + theme_bw() + theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26, family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif"),
plot.caption = element_text(hjust = 0.365, face= "italic", size=23),
plot.caption.position =  "plot"
) + labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,5000,10000,50000)
# , limits=c(1000,50000)
) +
guides(shape = guide_legend(override.aes = list(stroke=1.1),
label.theme = element_text(color="black", size=26,face="italic", family="serif",vjust = 1.5,margin = margin(t = 5)))
,color = guide_legend(override.aes = list(shape = 16, size = 6),
label.theme = element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 5))))+
labs(
caption = substitute(paste("LM model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(lm((data_4$SVR)~log10(data_4$longevity)))))
)
p2
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
ggplotly(p1)
library(plotly)
ggplotly(p1)
p1 = ggplot(  data_1[data_1$species == "Dendroctonus_ponderosae"],aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1 = ggplot(  data_1[data_1$species == "Dendroctonus_ponderosae",],aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
p1
data_1 = data_1[data_1$species == "Dendroctonus_ponderosae",]
############## Pannel 2 B
ylabel="mean_as_busco"
xlabel="longevity"
shorebird <- comparative.data(arbrePhylo, data.frame(species=data_1[,"species"],xlabel=data_1[,xlabel],ylabel=data_1[,ylabel]), species, vcv=TRUE)
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
a
a
a
source("figure generator/library_path.R")
############## Pannel 2 B
ylabel="mean_as_busco"
xlabel="longevity"
shorebird <- comparative.data(arbrePhylo, data.frame(species=data_1[,"species"],xlabel=data_1[,xlabel],ylabel=data_1[,ylabel]), species, vcv=TRUE)
data_1 = data_1[data_1$species == "Dendroctonus_ponderosae",]
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
p2
source("figure generator/library_path.R")
############## Pannel 2 B
ylabel="mean_as_busco"
xlabel="longevity"
shorebird <- comparative.data(arbrePhylo, data.frame(species=data_1[,"species"],xlabel=data_1[,xlabel],ylabel=data_1[,ylabel]), species, vcv=TRUE)
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
View(data_1)
source("figure generator/library_path.R")
############## Pannel 2 B
ylabel="mean_as_busco"
xlabel="longevity"
shorebird <- comparative.data(arbrePhylo, data.frame(species=data_1[,"species"],xlabel=data_1[,xlabel],ylabel=data_1[,ylabel]), species, vcv=TRUE)
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
jpeg(paste(path_figure,"svr_busco_longevity.jpg",sep=""), width = 8500/resolution, height = 6000/resolution,res=700/resolution)
print(p1)
dev.off()
############## Pannel 2 C
point_color = c("Brain"="#5c89b2","Cerebellum"="#7bc7eb","Heart"="#8c1b1f","Liver"="#54833b","Kidney"="#c19e40",
"Testis"="#e16527","Ovary"="#ac3495","Head"="#A6CEE3")
# "#1F78B4" "#B2DF8A" "#33A02C" "#FB9A99" "#E31A1C" "#FDBF6F" "#FF7F00" "#fdfd99" "#e2cc1a"
point_shape=c("Gallus gallus"=5,
"Homo sapiens"=0,
"Macaca mulatta"=8,
"Monodelphis domestica"=2,
"Mus musculus"=1,
"Oryctolagus cuniculus"=4,
"Rattus norvegicus"=6,
"Dendroctonus ponderosae"=9
)
data_4 = read.delim("data/Data4_supp.tab",comment.char = "#")
data_4$species_name = str_replace_all(data_4$species,"_"," ")
data_4$longevity = data_1[data_4$species,]$longevity
data_4 = data_4[data_4$organs %in% names(point_color),]
life_span_order = tapply(data_4$longevity,data_4$species_name,mean)
life_span_order = life_span_order[order(life_span_order,decreasing = T)]
data_4$species_name = factor( data_4$species_name, levels = names(life_span_order))
p2 = ggplot(font.label = c(50, "plain"),font.legend= c(20, "plain"),font.x= c(20, "plain"),font.y= c(20, "plain"),
data_4, aes(x=longevity, y=SVR,group=species_name,shape=species_name)) +   ggtitle("Major introns (BUSCO genes)")+
geom_point(size=5,alpha=1,aes(color=organs),stroke=1.5)+ scale_color_manual("Organs",values=point_color) +
scale_y_continuous(breaks=seq(0.5,4.5,0.5),labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(0.5,4)) +
scale_shape_manual("Species",values=point_shape) + labs(fill="Species") +
xlab("Longevity (days, log scale)") + theme_bw() + theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26, family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif"),
plot.caption = element_text(hjust = 0.365, face= "italic", size=23),
plot.caption.position =  "plot"
) + labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,5000,10000,50000)
# , limits=c(1000,50000)
) +
guides(shape = guide_legend(override.aes = list(stroke=1.1),
label.theme = element_text(color="black", size=26,face="italic", family="serif",vjust = 1.5,margin = margin(t = 5)))
,color = guide_legend(override.aes = list(shape = 16, size = 6),
label.theme = element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 5))))+
labs(
caption = substitute(paste("LM model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(lm((data_4$SVR)~log10(data_4$longevity)))))
)
p2
jpeg(paste(path_figure,"C_Moreira_svr.jpg",sep=""), width = 8500/resolution, height = 5100/resolution,res=600/resolution)
print(p2)
dev.off()
#### Figure 2
imgA = load.image(paste(path_require,"n1_n2_n3.png",sep=""))
imgB = load.image(paste(path_figure,"svr_busco_longevity.jpg",sep=""))
imgC = load.image(paste(path_figure,"C_Moreira_svr.jpg",sep=""))
{
pdf(file=paste(path_pannel,"Figure2.pdf",sep=""), width=6.75, height=4)
m=matrix(rep(1,10*11), nrow=11)
for(i in 5:11){
m[i,]=c(rep(2,5),rep(3,5))
}
m
layout(m)
par(mar=c(0, 0, 1, 0))
plot(imgA, axes = F)
mtext("A", side=2,at=100,adj=-12, line=1, font=2, cex=1.2,las=2)
par(mar=c(0, 3, 0, 1))
plot(imgB, axes = F)
mtext("B",at=50,adj=1, side=2, line=1, font=2, cex=1.2,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgC, axes = F)
mtext("C", side=2,at=60,adj=1, line=1, font=2, cex=1.2,las=2)
dev.off()
}
p2 = ggplot(font.label = c(50, "plain"),font.legend= c(20, "plain"),font.x= c(20, "plain"),font.y= c(20, "plain"),
data_4, aes(x=longevity, y=SVR,group=species_name,shape=species_name)) +   ggtitle("Major introns (BUSCO genes)")+
geom_point(size=5,alpha=1,aes(color=organs),stroke=1.5)+ scale_color_manual("Organs",values=point_color) +
scale_y_continuous(breaks=seq(0.5,4.5,0.5),labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(0.5,4)) +
scale_shape_manual("Species",values=point_shape) + labs(fill="Species") +
xlab("Longevity (days, log scale)") + theme_bw() + theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26, family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif"),
plot.caption = element_text(hjust = 0.365, face= "italic", size=23),
plot.caption.position =  "plot"
) + labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) +
guides(shape = guide_legend(override.aes = list(stroke=1.1),
label.theme = element_text(color="black", size=26,face="italic", family="serif",vjust = 1.5,margin = margin(t = 5)))
,color = guide_legend(override.aes = list(shape = 16, size = 6),
label.theme = element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 5))))+
labs(
caption = substitute(paste("LM model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(lm((data_4$SVR)~log10(data_4$longevity)))))
)
p2
source("figure generator/library_path.R")
############## Pannel 2 B
ylabel="mean_as_busco"
xlabel="longevity"
shorebird <- comparative.data(arbrePhylo, data.frame(species=data_1[,"species"],xlabel=data_1[,xlabel],ylabel=data_1[,ylabel]), species, vcv=TRUE)
p1 = ggplot(  data_1,aes(data_1[,xlabel],data_1[,ylabel], fill=clade,text=species) )+ geom_point(shape=21,size=7,alpha=0.7)+
scale_fill_manual("Clades",values=vectorColor)+ ggtitle("Major introns (BUSCO genes)")+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) + theme_bw() +
scale_y_continuous(breaks=seq(0.5,4.5,0.5), labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(.5,4)) +
labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
xlab("Longevity (days, log scale)")+ theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26 ,family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 10)),
plot.caption = element_text(hjust = 0.4, face= "italic", size=23),
plot.caption.position =  "plot"
)+
labs(
caption =substitute(paste("PGLS model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(pgls((ylabel)~log10(xlabel),shorebird))))
)
p1
jpeg(paste(path_figure,"svr_busco_longevity.jpg",sep=""), width = 8500/resolution, height = 6000/resolution,res=700/resolution)
print(p1)
dev.off()
############## Pannel 2 C
point_color = c("Brain"="#5c89b2","Cerebellum"="#7bc7eb","Heart"="#8c1b1f","Liver"="#54833b","Kidney"="#c19e40",
"Testis"="#e16527","Ovary"="#ac3495","Head"="#A6CEE3")
# "#1F78B4" "#B2DF8A" "#33A02C" "#FB9A99" "#E31A1C" "#FDBF6F" "#FF7F00" "#fdfd99" "#e2cc1a"
point_shape=c("Gallus gallus"=5,
"Homo sapiens"=0,
"Macaca mulatta"=8,
"Monodelphis domestica"=2,
"Mus musculus"=1,
"Oryctolagus cuniculus"=4,
"Rattus norvegicus"=6,
"Dendroctonus ponderosae"=9
)
data_4 = read.delim("data/Data4_supp.tab",comment.char = "#")
data_4$species_name = str_replace_all(data_4$species,"_"," ")
data_4$longevity = data_1[data_4$species,]$longevity
data_4 = data_4[data_4$organs %in% names(point_color),]
life_span_order = tapply(data_4$longevity,data_4$species_name,mean)
life_span_order = life_span_order[order(life_span_order,decreasing = T)]
data_4$species_name = factor( data_4$species_name, levels = names(life_span_order))
p2 = ggplot(font.label = c(50, "plain"),font.legend= c(20, "plain"),font.x= c(20, "plain"),font.y= c(20, "plain"),
data_4, aes(x=longevity, y=SVR,group=species_name,shape=species_name)) +   ggtitle("Major introns (BUSCO genes)")+
geom_point(size=5,alpha=1,aes(color=organs),stroke=1.5)+ scale_color_manual("Organs",values=point_color) +
scale_y_continuous(breaks=seq(0.5,4.5,0.5),labels=paste(seq(0.5,4.5,0.5),"%"),limits=c(0.5,4)) +
scale_shape_manual("Species",values=point_shape) + labs(fill="Species") +
xlab("Longevity (days, log scale)") + theme_bw() + theme(
axis.title.x = element_text(color="black",margin = margin(t = 15, r = 0, b = 0, l = 0), size=31,family="serif"),
axis.title.y = element_text(color="black",margin = margin(t = 0, r = 20, b = 0, l = 0), size=31, family="serif"),
axis.text.y =  element_text(color="black", size=26, family="serif"),
axis.text.x =  element_text(color="black", size=26, family="serif"),
title =  element_text(color="black", size=26, family="serif"),
text =  element_text(color="black", size=31, family="serif"),
legend.text =  element_text(color="black", size=26, family="serif"),
plot.caption = element_text(hjust = 0.365, face= "italic", size=23),
plot.caption.position =  "plot"
) + labs(y=expression(paste("Average AS rate ",italic("per")," intron")))+
scale_x_log10(breaks=c(0.05,0.1,0.5,1,5,10,50,100,1000,10000,50000), limits=c(7,50000)) +
guides(shape = guide_legend(override.aes = list(stroke=1.1),
label.theme = element_text(color="black", size=26,face="italic", family="serif",vjust = 1.5,margin = margin(t = 5)))
,color = guide_legend(override.aes = list(shape = 16, size = 6),
label.theme = element_text(color="black", size=26, family="serif",vjust = 1.5,margin = margin(t = 5))))+
labs(
caption = substitute(paste("LM model:"," R"^2,pgls_eq), list(pgls_eq=lm_eqn(lm((data_4$SVR)~log10(data_4$longevity)))))
)
p2
jpeg(paste(path_figure,"C_Moreira_svr.jpg",sep=""), width = 8500/resolution, height = 5100/resolution,res=600/resolution)
print(p2)
dev.off()
#### Figure 2
imgA = load.image(paste(path_require,"n1_n2_n3.png",sep=""))
imgB = load.image(paste(path_figure,"svr_busco_longevity.jpg",sep=""))
imgC = load.image(paste(path_figure,"C_Moreira_svr.jpg",sep=""))
{
pdf(file=paste(path_pannel,"Figure2.pdf",sep=""), width=6.75, height=4)
m=matrix(rep(1,10*11), nrow=11)
for(i in 5:11){
m[i,]=c(rep(2,5),rep(3,5))
}
m
layout(m)
par(mar=c(0, 0, 1, 0))
plot(imgA, axes = F)
mtext("A", side=2,at=100,adj=-12, line=1, font=2, cex=1.2,las=2)
par(mar=c(0, 3, 0, 1))
plot(imgB, axes = F)
mtext("B",at=50,adj=1, side=2, line=1, font=2, cex=1.2,las=2)
par(mar=c(0, 0, 0, 0))
plot(imgC, axes = F)
mtext("C", side=2,at=60,adj=1, line=1, font=2, cex=1.2,las=2)
dev.off()
}
tissue_list = c( "_ovar","_head","_test")
for(species in c("Dendroctonus_ponderosae")){print(species)
sra_table = read.delim(paste(pathData,"Annotations/",species,"/SRAruninfo.tab",sep=""))
intron_all = read.delim(paste(pathData,"Analyses/",species,"/by_intron_cds.tab",sep=""), header=T , sep="\t",comment.char = "#")
intron_all$id = paste(intron_all$gene_id,intron_all$splice3,intron_all$splice5,intron_all$seqname,intron_all$strand,sep=";")
rownames(intron_all) = intron_all$id
busco_tab = read.delim(paste(pathData,"Annotations/",species,"/busco_analysis/busco_to_gene_id_metazoa",sep="" ) )
for (tissue in tissue_list){print(tissue)
samples = sra_table[grepl(tissue,sra_table$LibraryName),]$Run
print(samples)
by_intron = read.delim(paste(pathData,"Analyses/",species,"/by_intron_db.tab.gz",sep=""), header=T , sep="\t",comment.char = "#")
by_intron = by_intron[colnames(by_intron)[grepl(paste(c("gene_id","seqname","strand","splice5","splice3",samples),collapse = "|"),colnames(by_intron))]]
by_intron$sum_n1 = rowSums(by_intron[grepl("n1",colnames(by_intron))])
by_intron$sum_n2 = rowSums(by_intron[grepl("n2",colnames(by_intron))])
by_intron$sum_n3 = rowSums(by_intron[grepl("n3",colnames(by_intron))])
fpkm_cov = read.delim(paste(pathData,"Analyses/",species,"/by_gene_db.tab.gz",sep=""), header=T , sep="\t",comment.char = "#")
fpkm_cov = fpkm_cov[fpkm_cov$gene_id %in% busco_tab$gene_id ,]
fpkm_cov = fpkm_cov[colnames(fpkm_cov)[grepl(paste(c("gene_id",samples),collapse = "|"),colnames(fpkm_cov))]]
fpkm_cov$sum_exon_coverage = rowSums(fpkm_cov[grepl("exon_coverage_",colnames(fpkm_cov))])
CoverageBuscoExon = round(median(tapply(fpkm_cov$sum_exon_coverage,fpkm_cov$gene_id,mean),na.rm=T)) # detection de la couverture médiane des gènes Busco
busco_tab = busco_tab[!(duplicated(busco_tab$busco_id,fromLast = FALSE) | duplicated(busco_tab$busco_id,fromLast = TRUE)) &
!(duplicated(busco_tab$gene_id,fromLast = FALSE) | duplicated(busco_tab$gene_id,fromLast = TRUE)) ,]
by_intron = by_intron[by_intron$gene_id %in% busco_tab$gene_id ,]
by_intron$splice_variant_rate = by_intron$sum_n2 / (by_intron$sum_n1 + by_intron$sum_n2)
by_intron[(by_intron$sum_n1 + by_intron$sum_n2) < 10,]$splice_variant_rate = NA
by_intron$nonsplice_variant_rate = by_intron$sum_n3 / (by_intron$sum_n3 + 2*by_intron$sum_n1)
by_intron[(by_intron$sum_n3/2 + by_intron$sum_n1) < 10,]$nonsplice_variant_rate = NA
by_intron$intron_class = "Unclassified"
by_intron[sapply((by_intron$sum_n1 > 0) & (by_intron$nonsplice_variant_rate < 0.5) &
(by_intron$splice_variant_rate < 0.5),isTRUE),]$intron_class = "major"
by_intron[sapply((by_intron$sum_n1 > 0) & (by_intron$nonsplice_variant_rate >= 0.5) |
(by_intron$splice_variant_rate >= 0.5),isTRUE), ]$intron_class = "minor"
table(by_intron$intron_class)
by_intron = by_intron[by_intron$intron_class =="major" & by_intron$gene_id %in% busco_tab$gene_id ,]
by_intron$id = paste(by_intron$gene_id,by_intron$splice3,by_intron$splice5,by_intron$seqname,by_intron$strand,sep=";")
by_intron$into_cds = intron_all[by_intron$id,]$into_cds
by_intron = by_intron[by_intron$into_cds =="True",]
# Collecte les données
df = rbind(df , data.frame(
species ,
SVR = mean(by_intron$splice_variant_rate)*100 ,
Bioproject = tissue ,
couverture = CoverageBuscoExon ,
nbIntron = nrow(by_intron) ,
organs = tissue
))
}
}
sra_table
View(sra_table)
